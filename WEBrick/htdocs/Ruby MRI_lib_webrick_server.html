<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Ruby MRI/lib/webrick/server.rb</title>
  <meta charset="utf-8">
  <link href="Ruby%20MRI_lib_webrick_server_files/style.css" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="http://rxr.whitequark.org/favicon.ico">
  <meta name="description" content="Ruby Cross Reference, a hypertext guide to Ruby MRI source code.">
<link type="text/css" rel="stylesheet" href="Ruby%20MRI_lib_webrick_server_files/mytube.css"><script src="Ruby%20MRI_lib_webrick_server_files/track.js" data-site-id="502704d6f5a1f54d1e00000e" id="gauges-tracker" async="" type="text/javascript"></script><script src="Ruby%20MRI_lib_webrick_server_files/ga.js" async="" type="text/javascript"></script><script src="Ruby%20MRI_lib_webrick_server_files/mutationObserver.js"></script><script src="Ruby%20MRI_lib_webrick_server_files/mytube.js"></script></head>

<body><div id="wrapper" class="">

<header>
  <nav>
    <ul>
      
      <li><span class="modes-sel">source navigation</span></li>
      <li><a class="modes" href="http://rxr.whitequark.org/mri/ident">identifier search</a></li>
      <li><a class="modes" href="http://rxr.whitequark.org/mri/search">general search</a></li>
      <li><a class="modes" href="http://rxr.whitequark.org/mri/diff/lib/webrick/server.rb">diff markup</a></li>
    </ul>
  </nav>
  <h1><a href="http://rxr.whitequark.org/">The Ruby Cross Reference</a></h1>
  <div class="push"></div>
</header>

<div id="variables">
  <span class="variable">Implementation:</span>
    <span class="var-sel">mri</span> <a class="varlink" href="http://rxr.whitequark.org/jruby/source">jruby</a> <a class="varlink" href="http://rxr.whitequark.org/rubinius/source">rubinius</a> 
  <br>

  
  <span class="variable">Version:</span>
    <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=1.8.7-p374">1.8.7-p374</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=1.9.1-p431">1.9.1-p431</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=1.9.2-p381">1.9.2-p381</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=1.9.3-p547">1.9.3-p547</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=2.0.0-p481">2.0.0-p481</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=2.1.0">2.1.0</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=2.1.1">2.1.1</a> <a class="varlink" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb?v=2.1.2">2.1.2</a> <span class="var-sel">HEAD</span> 
  <br>
  
</div>

<h2 id="banner"><span class="banner"><a class="banner" href="http://rxr.whitequark.org/mri/source/">Ruby MRI</a>/​<a class="banner" href="http://rxr.whitequark.org/mri/source/lib/">lib</a>/​<a class="banner" href="http://rxr.whitequark.org/mri/source/lib/webrick/">webrick</a>/​<a class="banner" href="http://rxr.whitequark.org/mri/source/lib/webrick/server.rb">server.rb</a></span></h2>
<pre class="file"><a class="line" id="001">001</a> <span class="comment">#</span>
<a class="line" id="002">002</a> <span class="comment"># server.rb -- GenericServer Class</span>
<a class="line" id="003">003</a> <span class="comment">#</span>
<a class="line" id="004">004</a> <span class="comment"># Author: IPR -- Internet Programming with Ruby -- writers</span>
<a class="line" id="005">005</a> <span class="comment"># Copyright (c) 2000, 2001 TAKAHASHI Masayoshi, GOTOU Yuuzou</span>
<a class="line" id="006">006</a> <span class="comment"># Copyright (c) 2002 Internet Programming with Ruby writers. All rights</span>
<a class="line" id="007">007</a> <span class="comment"># reserved.</span>
<a class="line" id="008">008</a> <span class="comment">#</span>
<a class="line" id="009">009</a> <span class="comment"># $IPR: server.rb,v 1.62 2003/07/22 19:20:43 gotoyuzo Exp $</span>
<a class="line" id="010">010</a> 
<a class="line" id="011">011</a> require '<a class="include" href="http://rxr.whitequark.org/mri/source/lib/thread.rb">thread</a>'
<a class="line" id="012">012</a> require 'socket'
<a class="line" id="013">013</a> require '<a class="include" href="http://rxr.whitequark.org/mri/source/lib/webrick/config.rb">webrick/config</a>'
<a class="line" id="014">014</a> require '<a class="include" href="http://rxr.whitequark.org/mri/source/lib/webrick/log.rb">webrick/log</a>'
<a class="line" id="015">015</a> 
<a class="line" id="016">016</a> <span class="reserved">module</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=WEBrick">WEBrick</a>
<a class="line" id="017">017</a> 
<a class="line" id="018">018</a>   <span class="comment">##</span>
<a class="line" id="019">019</a>   <span class="comment"># Server error exception</span>
<a class="line" id="020">020</a> 
<a class="line" id="021">021</a>   <span class="reserved">class</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ServerError">ServerError</a> &lt; StandardError; <span class="reserved">end</span>
<a class="line" id="022">022</a> 
<a class="line" id="023">023</a>   <span class="comment">##</span>
<a class="line" id="024">024</a>   <span class="comment"># Base server class</span>
<a class="line" id="025">025</a> 
<a class="line" id="026">026</a>   <span class="reserved">class</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=SimpleServer">SimpleServer</a>
<a class="line" id="027">027</a> 
<a class="line" id="028">028</a>     <span class="comment">##</span>
<a class="line" id="029">029</a>     <span class="comment"># A SimpleServer only yields when you start it</span>
<a class="line" id="030">030</a> 
<a class="line" id="031">031</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=SimpleServer">SimpleServer</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start">start</a>
<a class="line" id="032">032</a>       <span class="reserved">yield</span>
<a class="line" id="033">033</a>     <span class="reserved">end</span>
<a class="line" id="034">034</a>   <span class="reserved">end</span>
<a class="line" id="035">035</a> 
<a class="line" id="036">036</a>   <span class="comment">##</span>
<a class="line" id="037">037</a>   <span class="comment"># A generic module for daemonizing a process</span>
<a class="line" id="038">038</a> 
<a class="line" id="039">039</a>   <span class="reserved">class</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Daemon">Daemon</a>
<a class="line" id="040">040</a> 
<a class="line" id="041">041</a>     <span class="comment">##</span>
<a class="line" id="042">042</a>     <span class="comment"># Performs the standard operations for daemonizing a process.  Runs a</span>
<a class="line" id="043">043</a>     <span class="comment"># block, if given.</span>
<a class="line" id="044">044</a> 
<a class="line" id="045">045</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Daemon">Daemon</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start">start</a>
<a class="line" id="046">046</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=exit%21">exit!</a>(0) <span class="reserved">if</span> fork
<a class="line" id="047">047</a>       Process::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=setsid">setsid</a>
<a class="line" id="048">048</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=exit%21">exit!</a>(0) <span class="reserved">if</span> fork
<a class="line" id="049">049</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Dir">Dir</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=chdir">chdir</a>(<span class="string">"/"</span>)
<a class="line" id="050">050</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=File">File</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=umask">umask</a>(0)
<a class="line" id="051">051</a>       STDIN.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=reopen">reopen</a>(<span class="string">"/dev/null"</span>)
<a class="line" id="052">052</a>       STDOUT.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=reopen">reopen</a>(<span class="string">"/dev/null"</span>, <span class="string">"w"</span>)
<a class="line" id="053">053</a>       STDERR.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=reopen">reopen</a>(<span class="string">"/dev/null"</span>, <span class="string">"w"</span>)
<a class="line" id="054">054</a>       <span class="reserved">yield</span> <span class="reserved">if</span> block_given?
<a class="line" id="055">055</a>     <span class="reserved">end</span>
<a class="line" id="056">056</a>   <span class="reserved">end</span>
<a class="line" id="057">057</a> 
<a class="line" id="058">058</a>   <span class="comment">##</span>
<a class="line" id="059">059</a>   <span class="comment"># Base TCP server class.  You must subclass GenericServer and provide a #run</span>
<a class="line" id="060">060</a>   <span class="comment"># method.</span>
<a class="line" id="061">061</a> 
<a class="line" id="062">062</a>   <span class="reserved">class</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=GenericServer">GenericServer</a>
<a class="line" id="063">063</a> 
<a class="line" id="064">064</a>     <span class="comment">##</span>
<a class="line" id="065">065</a>     <span class="comment"># The server status.  One of :Stop, :Running or :Shutdown</span>
<a class="line" id="066">066</a> 
<a class="line" id="067">067</a>     attr_reader <span class="string">:status</span>
<a class="line" id="068">068</a> 
<a class="line" id="069">069</a>     <span class="comment">##</span>
<a class="line" id="070">070</a>     <span class="comment"># The server configuration</span>
<a class="line" id="071">071</a> 
<a class="line" id="072">072</a>     attr_reader <span class="string">:config</span>
<a class="line" id="073">073</a> 
<a class="line" id="074">074</a>     <span class="comment">##</span>
<a class="line" id="075">075</a>     <span class="comment"># The server logger.  This is independent from the HTTP access log.</span>
<a class="line" id="076">076</a> 
<a class="line" id="077">077</a>     attr_reader <span class="string">:logger</span>
<a class="line" id="078">078</a> 
<a class="line" id="079">079</a>     <span class="comment">##</span>
<a class="line" id="080">080</a>     <span class="comment"># Tokens control the number of outstanding clients.  The</span>
<a class="line" id="081">081</a>     <span class="comment"># &lt;code&gt;:MaxClients&lt;/code&gt; configuration sets this.</span>
<a class="line" id="082">082</a> 
<a class="line" id="083">083</a>     attr_reader <span class="string">:tokens</span>
<a class="line" id="084">084</a> 
<a class="line" id="085">085</a>     <span class="comment">##</span>
<a class="line" id="086">086</a>     <span class="comment"># Sockets listening for connections.</span>
<a class="line" id="087">087</a> 
<a class="line" id="088">088</a>     attr_reader <span class="string">:listeners</span>
<a class="line" id="089">089</a> 
<a class="line" id="090">090</a>     <span class="comment">##</span>
<a class="line" id="091">091</a>     <span class="comment"># Creates a new generic server from +config+.  The default configuration</span>
<a class="line" id="092">092</a>     <span class="comment"># comes from +default+.</span>
<a class="line" id="093">093</a> 
<a class="line" id="094">094</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=initialize">initialize</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=config">config</a>={}, <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=default">default</a>=<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Config">Config</a>::General)
<a class="line" id="095">095</a>       @config = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=default">default</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=dup">dup</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=update">update</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=config">config</a>)
<a class="line" id="096">096</a>       @status = <span class="string">:Stop</span>
<a class="line" id="097">097</a>       @config[<span class="string">:Logger</span>] ||= <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Log">Log</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=new">new</a>
<a class="line" id="098">098</a>       @logger = @config[<span class="string">:Logger</span>]
<a class="line" id="099">099</a> 
<a class="line" id="100">100</a>       @tokens = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=SizedQueue">SizedQueue</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=new">new</a>(@config[<span class="string">:MaxClients</span>])
<a class="line" id="101">101</a>       @config[<span class="string">:MaxClients</span>].<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=times">times</a>{ @tokens.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=push">push</a>(<span class="reserved">nil</span>) }
<a class="line" id="102">102</a> 
<a class="line" id="103">103</a>       webrickv = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=WEBrick">WEBrick</a>::VERSION
<a class="line" id="104">104</a>       rubyv = <span class="string">"#{RUBY_VERSION} (#{RUBY_RELEASE_DATE}) [#{RUBY_PLATFORM}]"</span>
<a class="line" id="105">105</a>       @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=info">info</a>(<span class="string">"WEBrick #{webrickv}"</span>)
<a class="line" id="106">106</a>       @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=info">info</a>(<span class="string">"ruby #{rubyv}"</span>)
<a class="line" id="107">107</a> 
<a class="line" id="108">108</a>       @listeners = []
<a class="line" id="109">109</a>       <span class="reserved">unless</span> @config[<span class="string">:DoNotListen</span>]
<a class="line" id="110">110</a>         <span class="reserved">if</span> @config[<span class="string">:Listen</span>]
<a class="line" id="111">111</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=warn">warn</a>(<span class="string">":Listen option is deprecated; use GenericServer#listen"</span>)
<a class="line" id="112">112</a>         <span class="reserved">end</span>
<a class="line" id="113">113</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=listen">listen</a>(@config[<span class="string">:BindAddress</span>], @config[<span class="string">:Port</span>])
<a class="line" id="114">114</a>         <span class="reserved">if</span> @config[<span class="string">:Port</span>] == 0
<a class="line" id="115">115</a>           @config[<span class="string">:Port</span>] = @listeners[0].<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=addr">addr</a>[1]
<a class="line" id="116">116</a>         <span class="reserved">end</span>
<a class="line" id="117">117</a>       <span class="reserved">end</span>
<a class="line" id="118">118</a>     <span class="reserved">end</span>
<a class="line" id="119">119</a> 
<a class="line" id="120">120</a>     <span class="comment">##</span>
<a class="line" id="121">121</a>     <span class="comment"># Retrieves +key+ from the configuration</span>
<a class="line" id="122">122</a> 
<a class="line" id="123">123</a>     <span class="reserved">def</span> [](<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=key">key</a>)
<a class="line" id="124">124</a>       @config[<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=key">key</a>]
<a class="line" id="125">125</a>     <span class="reserved">end</span>
<a class="line" id="126">126</a> 
<a class="line" id="127">127</a>     <span class="comment">##</span>
<a class="line" id="128">128</a>     <span class="comment"># Adds listeners from +address+ and +port+ to the server.  See</span>
<a class="line" id="129">129</a>     <span class="comment"># WEBrick::Utils::create_listeners for details.</span>
<a class="line" id="130">130</a> 
<a class="line" id="131">131</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=listen">listen</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=address">address</a>, <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=port">port</a>)
<a class="line" id="132">132</a>       @listeners += <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Utils">Utils</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=create_listeners">create_listeners</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=address">address</a>, <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=port">port</a>, @logger)
<a class="line" id="133">133</a>     <span class="reserved">end</span>
<a class="line" id="134">134</a> 
<a class="line" id="135">135</a>     <span class="comment">##</span>
<a class="line" id="136">136</a>     <span class="comment"># Starts the server and runs the +block+ for each connection.  This method</span>
<a class="line" id="137">137</a>     <span class="comment"># does not return until the server is stopped from a signal handler or</span>
<a class="line" id="138">138</a>     <span class="comment"># another thread using #stop or #shutdown.</span>
<a class="line" id="139">139</a>     <span class="comment">#</span>
<a class="line" id="140">140</a>     <span class="comment"># If the block raises a subclass of StandardError the exception is logged</span>
<a class="line" id="141">141</a>     <span class="comment"># and ignored.  If an IOError or Errno::EBADF exception is raised the</span>
<a class="line" id="142">142</a>     <span class="comment"># exception is ignored.  If an Exception subclass is raised the exception</span>
<a class="line" id="143">143</a>     <span class="comment"># is logged and re-raised which stops the server.</span>
<a class="line" id="144">144</a>     <span class="comment">#</span>
<a class="line" id="145">145</a>     <span class="comment"># To completely shut down a server call #shutdown from ensure:</span>
<a class="line" id="146">146</a>     <span class="comment">#</span>
<a class="line" id="147">147</a>     <span class="comment">#   server = WEBrick::GenericServer.new</span>
<a class="line" id="148">148</a>     <span class="comment">#   # or WEBrick::HTTPServer.new</span>
<a class="line" id="149">149</a>     <span class="comment">#</span>
<a class="line" id="150">150</a>     <span class="comment">#   begin</span>
<a class="line" id="151">151</a>     <span class="comment">#     server.start</span>
<a class="line" id="152">152</a>     <span class="comment">#   ensure</span>
<a class="line" id="153">153</a>     <span class="comment">#     server.shutdown</span>
<a class="line" id="154">154</a>     <span class="comment">#   end</span>
<a class="line" id="155">155</a> 
<a class="line" id="156">156</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start">start</a>(&amp;<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=block">block</a>)
<a class="line" id="157">157</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=raise">raise</a> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ServerError">ServerError</a>, <span class="string">"already started."</span> <span class="reserved">if</span> @status != <span class="string">:Stop</span>
<a class="line" id="158">158</a>       server_type = @config[<span class="string">:ServerType</span>] || <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=SimpleServer">SimpleServer</a>
<a class="line" id="159">159</a> 
<a class="line" id="160">160</a>       server_type.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start">start</a>{
<a class="line" id="161">161</a>         @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=info">info</a> \
<a class="line" id="162">162</a>           <span class="string">"#{self.class}#start: pid=#{$$} port=#{@config[:Port]}"</span>
<a class="line" id="163">163</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=call_callback">call_callback</a>(<span class="string">:StartCallback</span>)
<a class="line" id="164">164</a> 
<a class="line" id="165">165</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=thgroup">thgroup</a> = ThreadGroup.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=new">new</a>
<a class="line" id="166">166</a>         @status = <span class="string">:Running</span>
<a class="line" id="167">167</a>         <span class="reserved">begin</span>
<a class="line" id="168">168</a>           <span class="reserved">while</span> @status == <span class="string">:Running</span>
<a class="line" id="169">169</a>             <span class="reserved">begin</span>
<a class="line" id="170">170</a>               <span class="reserved">if</span> svrs = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=IO">IO</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=select">select</a>(@listeners, <span class="reserved">nil</span>, <span class="reserved">nil</span>, 2.0)
<a class="line" id="171">171</a>                 svrs[0].<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=each">each</a>{|<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=svr">svr</a>|
<a class="line" id="172">172</a>                   @tokens.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=pop">pop</a>          <span class="comment"># blocks while no token is there.</span>
<a class="line" id="173">173</a>                   <span class="reserved">if</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a> = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=accept_client">accept_client</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=svr">svr</a>)
<a class="line" id="174">174</a>                     <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=do_not_reverse_lookup">do_not_reverse_lookup</a> = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=config">config</a>[<span class="string">:DoNotReverseLookup</span>]
<a class="line" id="175">175</a>                     <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=th">th</a> = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start_thread">start_thread</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>, &amp;<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=block">block</a>)
<a class="line" id="176">176</a>                     <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=th">th</a>[<span class="string">:WEBrickThread</span>] = <span class="reserved">true</span>
<a class="line" id="177">177</a>                     <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=thgroup">thgroup</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=add">add</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=th">th</a>)
<a class="line" id="178">178</a>                   <span class="reserved">else</span>
<a class="line" id="179">179</a>                     @tokens.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=push">push</a>(<span class="reserved">nil</span>)
<a class="line" id="180">180</a>                   <span class="reserved">end</span>
<a class="line" id="181">181</a>                 }
<a class="line" id="182">182</a>               <span class="reserved">end</span>
<a class="line" id="183">183</a>             <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=EBADF">EBADF</a>, IOError =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="184">184</a>               <span class="comment"># if the listening socket was closed in GenericServer#shutdown,</span>
<a class="line" id="185">185</a>               <span class="comment"># IO::select raise it.</span>
<a class="line" id="186">186</a>             <span class="reserved">rescue</span> StandardError =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="187">187</a>               <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=msg">msg</a> = <span class="string">"#{ex.class}: #{ex.message}\n\t#{ex.backtrace[0]}"</span>
<a class="line" id="188">188</a>               @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=error">error</a> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=msg">msg</a>
<a class="line" id="189">189</a>             <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Exception">Exception</a> =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="190">190</a>               @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=fatal">fatal</a> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="191">191</a>               <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=raise">raise</a>
<a class="line" id="192">192</a>             <span class="reserved">end</span>
<a class="line" id="193">193</a>           <span class="reserved">end</span>
<a class="line" id="194">194</a> 
<a class="line" id="195">195</a>         <span class="reserved">ensure</span>
<a class="line" id="196">196</a>           @status = <span class="string">:Shutdown</span>
<a class="line" id="197">197</a>           @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=info">info</a> <span class="string">"going to shutdown ..."</span>
<a class="line" id="198">198</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=thgroup">thgroup</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=list">list</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=each">each</a>{|<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=th">th</a>| <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=th">th</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=join">join</a> <span class="reserved">if</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=th">th</a>[<span class="string">:WEBrickThread</span>] }
<a class="line" id="199">199</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=call_callback">call_callback</a>(<span class="string">:StopCallback</span>)
<a class="line" id="200">200</a>           @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=info">info</a> <span class="string">"#{self.class}#start done."</span>
<a class="line" id="201">201</a>           @status = <span class="string">:Stop</span>
<a class="line" id="202">202</a>         <span class="reserved">end</span>
<a class="line" id="203">203</a>       }
<a class="line" id="204">204</a>     <span class="reserved">end</span>
<a class="line" id="205">205</a> 
<a class="line" id="206">206</a>     <span class="comment">##</span>
<a class="line" id="207">207</a>     <span class="comment"># Stops the server from accepting new connections.</span>
<a class="line" id="208">208</a> 
<a class="line" id="209">209</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=stop">stop</a>
<a class="line" id="210">210</a>       <span class="reserved">if</span> @status == <span class="string">:Running</span>
<a class="line" id="211">211</a>         @status = <span class="string">:Shutdown</span>
<a class="line" id="212">212</a>       <span class="reserved">end</span>
<a class="line" id="213">213</a>     <span class="reserved">end</span>
<a class="line" id="214">214</a> 
<a class="line" id="215">215</a>     <span class="comment">##</span>
<a class="line" id="216">216</a>     <span class="comment"># Shuts down the server and all listening sockets.  New listeners must be</span>
<a class="line" id="217">217</a>     <span class="comment"># provided to restart the server.</span>
<a class="line" id="218">218</a> 
<a class="line" id="219">219</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=shutdown">shutdown</a>
<a class="line" id="220">220</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=stop">stop</a>
<a class="line" id="221">221</a>       @listeners.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=each">each</a>{|<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=s">s</a>|
<a class="line" id="222">222</a>         <span class="reserved">if</span> @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug?">debug?</a>
<a class="line" id="223">223</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=addr">addr</a> = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=s">s</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=addr">addr</a>
<a class="line" id="224">224</a>           @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug">debug</a>(<span class="string">"close TCPSocket(#{addr[2]}, #{addr[1]})"</span>)
<a class="line" id="225">225</a>         <span class="reserved">end</span>
<a class="line" id="226">226</a>         <span class="reserved">begin</span>
<a class="line" id="227">227</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=s">s</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=shutdown">shutdown</a>
<a class="line" id="228">228</a>         <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ENOTCONN">ENOTCONN</a>
<a class="line" id="229">229</a>           <span class="comment"># when `Errno::ENOTCONN: Socket is not connected' on some platforms,</span>
<a class="line" id="230">230</a>           <span class="comment"># call #close instead of #shutdown.</span>
<a class="line" id="231">231</a>           <span class="comment"># (ignore @config[:ShutdownSocketWithoutClose])</span>
<a class="line" id="232">232</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=s">s</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=close">close</a>
<a class="line" id="233">233</a>         <span class="reserved">else</span>
<a class="line" id="234">234</a>           <span class="reserved">unless</span> @config[<span class="string">:ShutdownSocketWithoutClose</span>]
<a class="line" id="235">235</a>             <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=s">s</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=close">close</a>
<a class="line" id="236">236</a>           <span class="reserved">end</span>
<a class="line" id="237">237</a>         <span class="reserved">end</span>
<a class="line" id="238">238</a>       }
<a class="line" id="239">239</a>       @listeners.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=clear">clear</a>
<a class="line" id="240">240</a>     <span class="reserved">end</span>
<a class="line" id="241">241</a> 
<a class="line" id="242">242</a>     <span class="comment">##</span>
<a class="line" id="243">243</a>     <span class="comment"># You must subclass GenericServer and implement \#run which accepts a TCP</span>
<a class="line" id="244">244</a>     <span class="comment"># client socket</span>
<a class="line" id="245">245</a> 
<a class="line" id="246">246</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=run">run</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>)
<a class="line" id="247">247</a>       @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=fatal">fatal</a> <span class="string">"run() must be provided by user."</span>
<a class="line" id="248">248</a>     <span class="reserved">end</span>
<a class="line" id="249">249</a> 
<a class="line" id="250">250</a>     <span class="reserved">private</span>
<a class="line" id="251">251</a> 
<a class="line" id="252">252</a>     <span class="comment"># :stopdoc:</span>
<a class="line" id="253">253</a> 
<a class="line" id="254">254</a>     <span class="comment">##</span>
<a class="line" id="255">255</a>     <span class="comment"># Accepts a TCP client socket from the TCP server socket +svr+ and returns</span>
<a class="line" id="256">256</a>     <span class="comment"># the client socket.</span>
<a class="line" id="257">257</a> 
<a class="line" id="258">258</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=accept_client">accept_client</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=svr">svr</a>)
<a class="line" id="259">259</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a> = <span class="reserved">nil</span>
<a class="line" id="260">260</a>       <span class="reserved">begin</span>
<a class="line" id="261">261</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a> = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=svr">svr</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=accept">accept</a>
<a class="line" id="262">262</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sync">sync</a> = <span class="reserved">true</span>
<a class="line" id="263">263</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Utils">Utils</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=set_non_blocking">set_non_blocking</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>)
<a class="line" id="264">264</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Utils">Utils</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=set_close_on_exec">set_close_on_exec</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>)
<a class="line" id="265">265</a>       <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ECONNRESET">ECONNRESET</a>, <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ECONNABORTED">ECONNABORTED</a>,
<a class="line" id="266">266</a>              <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=EPROTO">EPROTO</a>, <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=EINVAL">EINVAL</a> =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="267">267</a>       <span class="reserved">rescue</span> StandardError =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="268">268</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=msg">msg</a> = <span class="string">"#{ex.class}: #{ex.message}\n\t#{ex.backtrace[0]}"</span>
<a class="line" id="269">269</a>         @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=error">error</a> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=msg">msg</a>
<a class="line" id="270">270</a>       <span class="reserved">end</span>
<a class="line" id="271">271</a>       <span class="reserved">return</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>
<a class="line" id="272">272</a>     <span class="reserved">end</span>
<a class="line" id="273">273</a> 
<a class="line" id="274">274</a>     <span class="comment">##</span>
<a class="line" id="275">275</a>     <span class="comment"># Starts a server thread for the client socket +sock+ that runs the given</span>
<a class="line" id="276">276</a>     <span class="comment"># +block+.</span>
<a class="line" id="277">277</a>     <span class="comment">#</span>
<a class="line" id="278">278</a>     <span class="comment"># Sets the socket to the &lt;code&gt;:WEBrickSocket&lt;/code&gt; thread local variable</span>
<a class="line" id="279">279</a>     <span class="comment"># in the thread.</span>
<a class="line" id="280">280</a>     <span class="comment">#</span>
<a class="line" id="281">281</a>     <span class="comment"># If any errors occur in the block they are logged and handled.</span>
<a class="line" id="282">282</a> 
<a class="line" id="283">283</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start_thread">start_thread</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>, &amp;<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=block">block</a>)
<a class="line" id="284">284</a>       <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Thread">Thread</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=start">start</a>{
<a class="line" id="285">285</a>         <span class="reserved">begin</span>
<a class="line" id="286">286</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Thread">Thread</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=current">current</a>[<span class="string">:WEBrickSocket</span>] = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>
<a class="line" id="287">287</a>           <span class="reserved">begin</span>
<a class="line" id="288">288</a>             <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=addr">addr</a> = <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=peeraddr">peeraddr</a>
<a class="line" id="289">289</a>             @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug">debug</a> <span class="string">"accept: #{addr[3]}:#{addr[1]}"</span>
<a class="line" id="290">290</a>           <span class="reserved">rescue</span> SocketError
<a class="line" id="291">291</a>             @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug">debug</a> <span class="string">"accept: &lt;address unknown&gt;"</span>
<a class="line" id="292">292</a>             <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=raise">raise</a>
<a class="line" id="293">293</a>           <span class="reserved">end</span>
<a class="line" id="294">294</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=call_callback">call_callback</a>(<span class="string">:AcceptCallback</span>, <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>)
<a class="line" id="295">295</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=block">block</a> ? <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=block">block</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=call">call</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>) : <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=run">run</a>(<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>)
<a class="line" id="296">296</a>         <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Errno">Errno</a>::<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ENOTCONN">ENOTCONN</a>
<a class="line" id="297">297</a>           @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug">debug</a> <span class="string">"Errno::ENOTCONN raised"</span>
<a class="line" id="298">298</a>         <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ServerError">ServerError</a> =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="299">299</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=msg">msg</a> = <span class="string">"#{ex.class}: #{ex.message}\n\t#{ex.backtrace[0]}"</span>
<a class="line" id="300">300</a>           @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=error">error</a> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=msg">msg</a>
<a class="line" id="301">301</a>         <span class="reserved">rescue</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Exception">Exception</a> =&gt; <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="302">302</a>           @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=error">error</a> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=ex">ex</a>
<a class="line" id="303">303</a>         <span class="reserved">ensure</span>
<a class="line" id="304">304</a>           @tokens.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=push">push</a>(<span class="reserved">nil</span>)
<a class="line" id="305">305</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=Thread">Thread</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=current">current</a>[<span class="string">:WEBrickSocket</span>] = <span class="reserved">nil</span>
<a class="line" id="306">306</a>           <span class="reserved">if</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=addr">addr</a>
<a class="line" id="307">307</a>             @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug">debug</a> <span class="string">"close: #{addr[3]}:#{addr[1]}"</span>
<a class="line" id="308">308</a>           <span class="reserved">else</span>
<a class="line" id="309">309</a>             @logger.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=debug">debug</a> <span class="string">"close: &lt;address unknown&gt;"</span>
<a class="line" id="310">310</a>           <span class="reserved">end</span>
<a class="line" id="311">311</a>           <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=close">close</a> <span class="reserved">unless</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=sock">sock</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=closed?">closed?</a>
<a class="line" id="312">312</a>         <span class="reserved">end</span>
<a class="line" id="313">313</a>       }
<a class="line" id="314">314</a>     <span class="reserved">end</span>
<a class="line" id="315">315</a> 
<a class="line" id="316">316</a>     <span class="comment">##</span>
<a class="line" id="317">317</a>     <span class="comment"># Calls the callback +callback_name+ from the configuration with +args+</span>
<a class="line" id="318">318</a> 
<a class="line" id="319">319</a>     <span class="reserved">def</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=call_callback">call_callback</a>(callback_name, *<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=args">args</a>)
<a class="line" id="320">320</a>       <span class="reserved">if</span> <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=cb">cb</a> = @config[callback_name]
<a class="line" id="321">321</a>         <a class="ident" href="http://rxr.whitequark.org/mri/ident?i=cb">cb</a>.<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=call">call</a>(*<a class="ident" href="http://rxr.whitequark.org/mri/ident?i=args">args</a>)
<a class="line" id="322">322</a>       <span class="reserved">end</span>
<a class="line" id="323">323</a>     <span class="reserved">end</span>
<a class="line" id="324">324</a>   <span class="reserved">end</span>    <span class="comment"># end of GenericServer</span>
<a class="line" id="325">325</a> <span class="reserved">end</span></pre>
<footer>
  <nav class="buttons">
    <a href="http://validator.w3.org/check/referer"><img src="Ruby%20MRI_lib_webrick_server_files/valid-html5.png" alt="Valid HTML5"></a>
    <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="Ruby%20MRI_lib_webrick_server_files/valid-css2.png" alt="Valid CSS2"></a>
  </nav>

  This page was automatically generated by the 0.9.9
  <a href="http://lxr.sf.net/">LXR engine</a>.<br>
  <a href="http://rxr.whitequark.org/">Ruby Cross Reference</a> brought to you by
  <a href="mailto:whitequark@whitequark.org">Peter Zotov</a>.
</footer>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25526594-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '502704d6f5a1f54d1e00000e');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

</div>

<mytubeelement data="{&quot;bundle&quot;:{&quot;label_delimitor&quot;:&quot;:&quot;,&quot;percentage&quot;:&quot;%&quot;,&quot;smart_buffer&quot;:&quot;Smart Buffer&quot;,&quot;start_playing_when_buffered&quot;:&quot;Start playing when buffered&quot;,&quot;sound&quot;:&quot;Sound&quot;,&quot;desktop_notification&quot;:&quot;Desktop Notification&quot;,&quot;continuation_on_next_line&quot;:&quot;-&quot;,&quot;loop&quot;:&quot;Loop&quot;,&quot;only_notify&quot;:&quot;Only Notify&quot;,&quot;estimated_time&quot;:&quot;Estimated Time&quot;,&quot;global_preferences&quot;:&quot;Global Preferences&quot;,&quot;no_notification_supported_on_your_browser&quot;:&quot;No notification style supported on your browser version&quot;,&quot;video_buffered&quot;:&quot;Video Buffered&quot;,&quot;buffered&quot;:&quot;Buffered&quot;,&quot;hyphen&quot;:&quot;-&quot;,&quot;buffered_message&quot;:&quot;The video has been buffered as requested and is ready to play.&quot;,&quot;not_supported&quot;:&quot;Not Supported&quot;,&quot;on&quot;:&quot;On&quot;,&quot;off&quot;:&quot;Off&quot;,&quot;click_to_enable_for_this_site&quot;:&quot;Click to enable for this site&quot;,&quot;desktop_notification_denied&quot;:&quot;You have denied permission for desktop notification for this site&quot;,&quot;notification_status_delimitor&quot;:&quot;;&quot;,&quot;error&quot;:&quot;Error&quot;,&quot;adblock_interferance_message&quot;:&quot;Adblock (or similar extension) is known to interfere with SmartVideo. Please add this url to adblock whitelist.&quot;,&quot;calculating&quot;:&quot;Calculating&quot;,&quot;waiting&quot;:&quot;Waiting&quot;,&quot;will_start_buffering_when_initialized&quot;:&quot;Will start buffering when initialized&quot;,&quot;will_start_playing_when_initialized&quot;:&quot;Will start playing when initialized&quot;,&quot;completed&quot;:&quot;Completed&quot;,&quot;buffering_stalled&quot;:&quot;Buffering is stalled. Will stop.&quot;,&quot;stopped&quot;:&quot;Stopped&quot;,&quot;hr&quot;:&quot;Hr&quot;,&quot;min&quot;:&quot;Min&quot;,&quot;sec&quot;:&quot;Sec&quot;,&quot;any_moment&quot;:&quot;Any Moment&quot;,&quot;popup_donate_to&quot;:&quot;Donate to&quot;,&quot;extension_id&quot;:null},&quot;prefs&quot;:{&quot;desktopNotification&quot;:true,&quot;soundNotification&quot;:true,&quot;logLevel&quot;:0,&quot;enable&quot;:true,&quot;loop&quot;:false,&quot;hidePopup&quot;:false,&quot;autoPlay&quot;:false,&quot;autoBuffer&quot;:false,&quot;autoPlayOnBuffer&quot;:false,&quot;autoPlayOnBufferPercentage&quot;:42,&quot;autoPlayOnSmartBuffer&quot;:true,&quot;quality&quot;:&quot;default&quot;,&quot;fshd&quot;:false,&quot;onlyNotification&quot;:false,&quot;enableFullScreen&quot;:true,&quot;saveBandwidth&quot;:false,&quot;hideAnnotations&quot;:false,&quot;turnOffPagedBuffering&quot;:false}}" event="preferencesUpdated" id="myTubeRelayElementToPage"></mytubeelement><mytubeelement data="{&quot;loadBundle&quot;:true}" event="relayPrefs" id="myTubeRelayElementToTab"></mytubeelement></body></html>